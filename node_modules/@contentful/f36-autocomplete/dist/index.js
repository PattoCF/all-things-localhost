'use strict';

var n = require('react');
var emotion = require('emotion');
var downshift = require('downshift');
var f36Core = require('@contentful/f36-core');
var f36Button = require('@contentful/f36-button');
var f36Forms = require('@contentful/f36-forms');
var f36Icons = require('@contentful/f36-icons');
var f36Skeleton = require('@contentful/f36-skeleton');
var f36Popover = require('@contentful/f36-popover');
var f36Typography = require('@contentful/f36-typography');
var f36Utils = require('@contentful/f36-utils');
var a = require('@contentful/f36-tokens');

function _interopDefault (e) { return e && e.__esModule ? e : { default: e }; }

var n__default = /*#__PURE__*/_interopDefault(n);
var a__default = /*#__PURE__*/_interopDefault(a);

var we=Object.defineProperty,ke=Object.defineProperties;var Le=Object.getOwnPropertyDescriptors;var H=Object.getOwnPropertySymbols;var j=Object.prototype.hasOwnProperty,J=Object.prototype.propertyIsEnumerable;var z=(t,o,i)=>o in t?we(t,o,{enumerable:!0,configurable:!0,writable:!0,value:i}):t[o]=i,u=(t,o)=>{for(var i in o||(o={}))j.call(o,i)&&z(t,i,o[i]);if(H)for(var i of H(o))J.call(o,i)&&z(t,i,o[i]);return t},c=(t,o)=>ke(t,Le(o));var Q=(t,o)=>{var i={};for(var s in t)j.call(t,s)&&o.indexOf(s)<0&&(i[s]=t[s]);if(t!=null&&H)for(var s of H(t))o.indexOf(s)<0&&J.call(t,s)&&(i[s]=t[s]);return i};var w=t=>({autocomplete:emotion.css({position:"relative",width:"100%"}),combobox:emotion.css({position:"relative"}),inputField:emotion.css({paddingRight:a__default.default.spacingXl,textOverflow:"ellipsis",whiteSpace:"nowrap"}),toggleButton:emotion.css({position:"absolute",top:"1px",right:"1px",zIndex:1,padding:a__default.default.spacing2Xs,height:"38px"}),content:emotion.css({overflow:"auto",maxHeight:`${t}px`}),list:emotion.css({listStyle:"none",padding:`${a__default.default.spacingXs} 0`,margin:0}),groupTitle:emotion.css({padding:`${a__default.default.spacingXs} ${a__default.default.spacingM}`,lineHeight:a__default.default.lineHeightM}),noMatchesTitle:emotion.css({color:a__default.default.gray500,margin:`${a__default.default.spacingM} 0 ${a__default.default.spacingM} 0`}),item:emotion.css({display:"block",padding:`${a__default.default.spacingXs} ${a__default.default.spacingM}`,wordBreak:"break-word",whiteSpace:"break-spaces",cursor:"pointer",hyphens:"auto","&:focus, &:hover":{backgroundColor:a__default.default.gray100},"&:active":{backgroundColor:a__default.default.gray200}}),disabled:emotion.css({opacity:.5,pointerEvents:"none"}),highlighted:emotion.css({backgroundColor:a__default.default.gray100}),hidden:emotion.css({display:"none"})});var k=t=>{let{items:o,elementStartIndex:i,highlightedIndex:s,getItemProps:g,renderItem:x,inputValue:P,listMaxHeight:N=180}=t,I=w(N);return n__default.default.createElement("ul",{className:I.list,"data-test-id":"cf-autocomplete-list"},o.map((h,O)=>{let y=i+O,p=g({item:h,index:y});return n__default.default.createElement(f36Typography.Text,c(u({},p),{as:"li",key:y,className:emotion.cx([I.item,s===y&&I.highlighted]),"data-test-id":`cf-autocomplete-list-item-${y}`}),x?x(h,P):typeof h=="string"?n__default.default.createElement(Y,{item:h,inputValue:P}):h)}))};k.displayName="AutocompleteItems";function Y({item:t,inputValue:o}){let{before:i,match:s,after:g}=f36Utils.getStringMatch(t,o);return n__default.default.createElement(n__default.default.Fragment,null,i,n__default.default.createElement("b",null,s),g)}Y.displayName="HighlightedItem";function Xe(t,o){let {isOpen:i,onClose:s,onOpen:g,id:x,className:P,clearAfterSelect:N=!1,textOnAfterSelect:I=N?"clear":"replace",closeAfterSelect:h=!0,defaultValue:O="",selectedItem:y,items:p,inputValue:$,onInputValueChange:C,onSelectItem:te,onFocus:V,onBlur:G,renderItem:_,icon:oe=n__default.default.createElement(f36Icons.ChevronDownIcon,{variant:"muted"}),itemToString:ne=e=>e,isInvalid:ie,isDisabled:X,isRequired:se,isReadOnly:re,showEmptyList:pe,noMatchesMessage:ae="No matches found",placeholder:le="Search",inputRef:me,toggleRef:ue,listRef:ce,listWidth:de="auto",listMaxHeight:ge=180,isGrouped:M=!1,isLoading:S=!1,usePortal:he=!1,testId:fe="cf-autocomplete"}=t,m=w(ge),[Ie,ye]=n.useState(O),f=typeof $=="undefined"?Ie:$,v=n.useCallback(e=>{ye(e),C==null||C(e);},[C]),Te=n.useCallback(e=>{let r=e.target.value;v(r);},[v]),be=L(M)?p.reduce((e,r)=>[...e,...r.options],[]):p,ve=L(M)?p.every(e=>e.options.length===0):p.length===0,{getComboboxProps:xe,getInputProps:Pe,getItemProps:U,getMenuProps:Ce,getToggleButtonProps:Me,highlightedIndex:W,isOpen:Se,openMenu:Ae,toggleMenu:Ee}=downshift.useCombobox({isOpen:i,onIsOpenChange:({isOpen:e})=>{e?g==null||g():s==null||s();},stateReducer:(e,{type:r,changes:T})=>{switch(r){case downshift.useCombobox.stateChangeTypes.InputBlur:return c(u({},T),{inputValue:e.inputValue});case downshift.useCombobox.stateChangeTypes.InputKeyDownEnter:case downshift.useCombobox.stateChangeTypes.ItemClick:return h?T:c(u({},T),{isOpen:e.isOpen});default:return T}},items:be,selectedItem:y,inputValue:f,itemToString:ne,onInputValueChange:({type:e,inputValue:r})=>{switch(e){case downshift.useCombobox.stateChangeTypes.InputChange:return;case downshift.useCombobox.stateChangeTypes.ItemClick:case downshift.useCombobox.stateChangeTypes.InputKeyDownEnter:{if(I==="clear"){v("");return}if(I==="preserve")return}}v(r);},onStateChange:({type:e,selectedItem:r})=>{switch(e){case downshift.useCombobox.stateChangeTypes.InputKeyDownEnter:case downshift.useCombobox.stateChangeTypes.ItemClick:r&&te(r);break;}}}),K=Pe(),A=Q(K,["aria-labelledby","id"]),He=xe(),q=Me(),E=Ce(),R=0;return n__default.default.createElement("div",{"data-test-id":fe,className:emotion.cx(m.autocomplete,P),ref:o},n__default.default.createElement(f36Popover.Popover,{usePortal:he,isOpen:Se,isFullWidth:de==="full",renderOnlyWhenOpen:!1,autoFocus:!1,id:E.id},n__default.default.createElement(f36Popover.Popover.Trigger,null,n__default.default.createElement("div",c(u({},He),{className:m.combobox}),n__default.default.createElement(f36Forms.TextInput,c(u({className:m.inputField},A),{onFocus:e=>{V==null||V(e),Ae();},onBlur:e=>{G==null||G(e),A.onBlur(e);},id:x,isInvalid:ie,isDisabled:X,isRequired:se,isReadOnly:re,ref:f36Core.mergeRefs(A.ref,me),testId:"cf-autocomplete-input",placeholder:le,onChange:e=>{A.onChange(e),Te(e);}})),n__default.default.createElement(f36Button.IconButton,c(u({},q),{ref:f36Core.mergeRefs(q.ref,ue),"aria-label":f?"Clear":"Show list",className:m.toggleButton,variant:"transparent",icon:f?n__default.default.createElement(f36Icons.CloseIcon,{variant:"muted"}):oe,onClick:()=>{f?v(""):Ee();},isDisabled:X,size:"small"})))),p.length>0||f.length>0||pe?n__default.default.createElement(f36Popover.Popover.Content,c(u({},E),{ref:f36Core.mergeRefs(E.ref,ce),className:m.content,testId:"cf-autocomplete-container"}),S&&[...Array(3)].map((e,r)=>n__default.default.createElement("div",{key:r,className:emotion.cx(m.item,m.disabled)},n__default.default.createElement(Ue,null))),!S&&ve&&n__default.default.createElement("div",{className:m.item},n__default.default.createElement(f36Typography.Subheading,{className:m.noMatchesTitle},ae)),!S&&L(M)&&p.map((e,r)=>{if(e.options.length<1)return;let T=n__default.default.createElement("div",{key:r},n__default.default.createElement(f36Typography.SectionHeading,{key:r,"data-test-id":"cf-autocomplete-grouptitle",marginBottom:"none",className:m.groupTitle},e.groupTitle),n__default.default.createElement(k,{items:e.options,highlightedIndex:W,getItemProps:U,renderItem:_,inputValue:f,elementStartIndex:R}));return R+=e.options.length,T}),!S&&!L(M)&&p.length>0&&n__default.default.createElement(k,{items:p,elementStartIndex:R,highlightedIndex:W,getItemProps:U,renderItem:_,inputValue:f})):n__default.default.createElement("div",c(u({},E),{className:emotion.cx(m.hidden)}))))}var Ue=()=>n__default.default.createElement(f36Skeleton.Skeleton.Container,{svgHeight:16},n__default.default.createElement(f36Skeleton.Skeleton.BodyText,{numberOfLines:1}));function L(t,o){return t}var We=n__default.default.forwardRef(Xe);

exports.Autocomplete = We;
//# sourceMappingURL=out.js.map
//# sourceMappingURL=index.js.map